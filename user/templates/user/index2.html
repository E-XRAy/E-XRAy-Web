{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- jQuery library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{% static '/user/style.css' %}">
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-storage.js"></script>
    <!-- include the cornerstone library -->
    <script src="{% static '/user/cornerstone.min.js.download' %}"></script>
    <script src="{% static '/user/cornerstoneMath.min.js.download' %}"></script>
    <script src="{% static '/user/cornerstoneTools.min.js.download' %}"></script>

    <!-- include the dicomParser library as the WADO image loader depends on it -->
    <script src="{% static '/user/dicomParser.min.js.download' %}"></script>

    <!-- include the cornerstoneWADOImageLoader library
<script src="{% static '/user/cornerstoneWADOImageLoader.js.download' %}"></script> -->

    <script src="{% static '/user/uids.js.download' %}"></script>

    <!-- Lines ONLY required for this example to run without building the project -->
    <script>window.cornerstoneWADOImageLoader || document.write('<script src="https://unpkg.com/cornerstone-wado-image-loader">\x3C/script>')</script>
    <script src="{% static '/user/cornerstone-wado-image-loader' %}"></script>
    <script src="{% static '/user/initializeWebWorkers.js.download' %}"></script>



    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-analytics.js"></script>

    <script src="{% static '/user/init.js' %}"></script>
</head>

<body>
    <!--Nav Bar-->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark"> <button class="navbar-toggler" type="button"
            data-target="#navigation"> <span class="navbar-toggler-icon"></span> </button>
        <div class="collapse navbar-collapse">
            <div class="navbar-nav mr-auto">
                <a class="nav-item nav-link" href="#">Home</a>
            </div>
            <!-- Navbar Right Side -->
            <div class="navbar-nav">
                <section class="logged-in"><a class="nav-item nav-link profile" id='navprofile' onclick="openNav()"
                        href="#">Profile</a></section>
                <section class="logged-in"><a class="nav-item nav-link logout" id="logout">Logout</a></section>
                <section class="logged-out"><a class="nav-item nav-link login" data-toggle="modal"
                        data-target="#loginModal">Login</a></section>
                <section class="logged-out"><a class="nav-item nav-link register modal-trigger" id='navregister'
                        data-toggle="modal" data-target="#signupModal" href="#">Sign Up</a></section>

            </div>
        </div>
    </nav>
    <!--Side Bar-->
    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Ã—</a>
        <section id="userDetails">
        </section>
    </div>

    <script>
        function openNav() {
            document.getElementById("mySidebar").style.width = "500px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
        }
    </script>
    <!--LOGIN MODAL-->
    <div id="loginModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg" role="content">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Login</h4>
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="form-row">
                            <div class="form-group col-sm-4">
                                <label class="sr-only" for="exampleInputEmail3">Email address</label>
                                <input type="email" class="form-control form-control-sm mr-1" id="login-email"
                                    placeholder="Enter email">
                            </div>
                            <div class="form-group col-sm-4">
                                <label class="sr-only" for="exampleInputPassword3">Password</label>
                                <input type="password" class="form-control form-control-sm mr-1" id="login-password"
                                    placeholder="Password">
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="button" class="btn btn-secondary btn-sm ml-auto"
                                data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary btn-sm ml-1" id='login-button'>Log
                                in</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- SIGN UP MODAL -->
    <div id="signupModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg" role="content">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Sign Up</h4>
                    <button type="button" class="close" data-dismiss="modal">
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <form id="signup-form">
                        <div class="form-row">
                            <div class="form-group col-sm-4">
                                <label class="sr-only" for="exampleInputEmail3">Email address</label>
                                <input type="email" class="form-control form-control-sm mr-1" id="signup-email"
                                    placeholder="Enter email">
                            </div>
                            <div class="form-group col-sm-4">
                                <label class="sr-only" for="signup-password">Password</label>
                                <input type="password" class="form-control form-control-sm mr-1" id="signup-password"
                                    placeholder="Password">
                            </div>
                            <div class="form-group col-sm-4">
                                <label class="sr-only" for="signup-password2">Password</label>
                                <input type="password" class="form-control form-control-sm mr-1" id="signup-password2"
                                    placeholder="Repeat Password">
                            </div>
                        </div>
                        <div class="form-row">
                            <label for="UserType">Account For:</label>
                            <select class="custom-select form-control-sm col-sm-4" style="border-radius: 10px;"
                                id="signup-usertype" name="UserType">
                                <option value="Radiologist">Radiologist</option>
                                <option value="Doctor">Doctor</option>
                                <option value="Patient">Patient</option>
                            </select>
                        </div>
                        <div class="form">
                            <label for="UserName">UserName</label>
                            <input id="signup-username" class="form-control-sm col-sm-6" style="border-radius: 10px;"
                                type="text" placeholder="Enter User Name" name="username" required><br>
                            <label for="PhoneNumber">Phone Number</label>
                            <input id="signup-phoneno" class="form-control-sm col-sm-6" style="border-radius: 10px;"
                                type="text" placeholder="Enter Phone Number" name="PhoneNumber" required><br>
                            <label for="DesignId">Designation Id</label>
                            <input id="signup-designid" class="form-control-sm col-sm-6" style="border-radius: 10px;"
                                type="text" placeholder="Enter Designation Id name" name="DesignId" required><br>

                        </div>
                        <div class="form-row">
                            <button type="button" class="btn btn-secondary btn-sm ml-auto"
                                data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary btn-sm ml-1">Sign up</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Radiologist Section -->



    <section id="radiologist" style="display: none;">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-sm-3">
                    <h3 class="mt-3">Preview</h3>
                    <div id="radioFilePreview" class="jumbotron mt-4 ml-0" style="border-radius: 5px;">
                        <p><img id="output" width="300" /></p>
                        <div id="canvasgenerator"></div>
                    </div>
                    <form class="form-inline" id="search-patient" onsubmit="return false">
                        <input type="text" id="search-patient-name" class="form-control col-sm-8 mr-2 mb-2 mt-3"
                            style="border-radius: 10px" tabindex="1" placeholder="Enter Email">
                        <button type="submit" class="btn btn-outline-primary mt-1" style="border-radius: 10px"><i
                                class="fa fa-search" aria-hidden="true">Patient</i>
                        </button>
                    </form>
                </div>
                <div class="col-md-4 col-sm-3">

                    <form id="radio-files-form">
                        <div class="form pt-2">
                            <section id="searchPatientSuccess">
                                <div class="custom-file mb-1"><input type="file" class="custom-file-input"
                                        id="customFile" onchange="loadFile(event)" name="filename">
                                    <label class="custom-file-label" for="customFile">Choose file</label></div>
                                <label for="FileName">File Name</label>
                                <input id="FileName" class="form-control-sm col-sm-6" style="border-radius: 10px;"
                                    type="text" placeholder="Enter File Name" name="FileName" required><br>
                                <label for="FileType">Filetype</label>
                                <select class="custom-select form-control-sm col-sm-4" id="FileType" name="FileType">
                                    <option value="Xray" selected>Xray</option>
                                    <option value="MRI">MRI</option>
                                    <option value="UltraSound">UltraSound</option>
                                </select><br>
                                <label for="Notes">Content:</label>
                                <textarea class=" ml-0" style="border-radius: 5px; background-color:floralwhite"
                                    class="form-control" name="Notes" id="Notes" rows="2" cols="40"></textarea>
                                <button type="submit" class="btn btn-outline-primary"
                                    style="border-radius: 10px; float: right;">Upload<i class="fa fa-upload"
                                        aria-hidden="true"></i>
                                </button>
                            </section>
                        </div>
                    </form>

                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="jumbotron mt-3" style="border-radius: 50px;">
                        <form class="form-inline" method="POST" onsubmit="return false">
                            <input type="text" class="form-control col-sm-8 mr-2 mb-2" style="border-radius: 10px"
                                tabindex="1">
                            <button type="button" class="btn btn-outline-primary" style="border-radius: 10px"><i
                                    class="fa fa-search" aria-hidden="true"></i>
                            </button>
                        </form>
                        <div id="radiofileList" style="max-height: 400px;overflow: auto;">

                        </div>
                    </div>
                </div>
            </div>
        </div>



        <br>

        <script>
            cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
            cornerstoneWADOImageLoader.configure({
                beforeSend: function (xhr) {
                    // Add custom headers here (e.g. auth tokens)
                    //xhr.setRequestHeader('APIKEY', 'my auth token');
                }
            });
            var loaded = false;
            function loadAndViewImage(imageId) {
                var canvas = document.getElementsByTagName('canvas')[0];
                canvas.width = 300;
                canvas.height = 300;
                canvas.style.height = "300px";
                canvas.style.width = "300px";
                var element = document.getElementById('canvasgenerator');
                try {
                    var start = new Date().getTime();
                    cornerstone.loadAndCacheImage(imageId).then(function (image) {
                        console.log(image);
                        var viewport = cornerstone.getDefaultViewportForImage(element, image);
                        cornerstone.displayImage(element, image, viewport);
                        console.log(element);
                        console.log(viewport);
                        if (loaded === false) {
                            cornerstoneTools.mouseInput.enable(element);
                            cornerstoneTools.mouseWheelInput.enable(element);
                            cornerstoneTools.wwwc.activate(element, 1); // ww/wc is the default tool for left mouse button
                            cornerstoneTools.pan.activate(element, 2); // pan is the default tool for middle mouse button
                            cornerstoneTools.zoom.activate(element, 4); // zoom is the default tool for right mouse button
                            cornerstoneTools.zoomWheel.activate(element); // zoom is the default tool for middle mouse wheel
                            loaded = true;
                        }

                        function getTransferSyntax() {
                            const value = image.data.string('x00020010');
                            return value + ' [' + uids[value] + ']';
                        }

                        function getSopClass() {
                            const value = image.data.string('x00080016');
                            return value + ' [' + uids[value] + ']';
                        }

                        function getPixelRepresentation() {
                            const value = image.data.uint16('x00280103');
                            if (value === undefined) {
                                return;
                            }
                            return value + (value === 0 ? ' (unsigned)' : ' (signed)');
                        }

                        function getPlanarConfiguration() {
                            const value = image.data.uint16('x00280006');
                            if (value === undefined) {
                                return;
                            }
                            return value + (value === 0 ? ' (pixel)' : ' (plane)');
                        }
                    }, function (err) {
                        alert(err);
                    });
                }
                catch (err) {
                    alert(err);
                }
            }

            function downloadAndView() {
                let url = document.getElementById('wadoURL').value;
                // prefix the url with wadouri: so cornerstone can find the image loader
                url = "wadouri:" + url;
                // image enable the dicomImage element and activate a few tools
                loadAndViewImage(url);
            }
            function getUrlWithoutFrame() {
                var url = document.getElementById('wadoURL').value;
                var frameIndex = url.indexOf('frame=');
                if (frameIndex !== -1) {
                    url = url.substr(0, frameIndex - 1);
                }
                return url;
            }
            var element = document.getElementById('canvasgenerator');
            cornerstone.enable(element);

        </script>

    </section>
    <!-- Patient Section -->

    <section id="patient" style="display: none;">
        <div class="container">
            <div class="row">

                <div class="col-md-8 col-sm-6">
                    <h4 class="mt-3">Preview</h4>
                    <div id="patientFilePreview" class="jumbotron mt-4 ml-0" style="border-radius: 20px;">
                        <p><img id="output" width="300" /></p>
                        <div id="canvasgenerator1"></div>
                    </div>
                    <div class="container">
                        <form id="searchDoctor" class="form-inline" onsubmit="return false">
                            <input id="doctorEmailorPhone" type="text" class="form-control col-sm-8 mr-2 mb-2 mt-3"
                                style="border-radius: 10px" tabindex="1" placeholder="Enter Email or PhoneNumber">
                            <button type="submit" class="btn btn-outline-primary mt-1" style="border-radius: 10px"><i
                                    class="fa fa-search" aria-hidden="true">Doctor</i>
                            </button>
                        </form>
                        <form class="from-inline" id="searchedDoctor" style='display: none;'>
                            <input id="searchedDoctorName" type="text" class="form-control col-sm-8 mr-2 mb-2 mt-3"
                                style="border-radius: 10px" tabindex="1" disabled>
                            <button type="submit" class="btn btn-outline-primary" style="border-radius: 10px;">Sent<i
                                    class="fa fa-paper-plane" aria-hidden="true"></i>
                            </button>
                        </form>
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="jumbotron mt-3" style="border-radius: 50px;">
                        <form class="form-inline" method="POST" onsubmit="return false">
                            <input type="text" class="form-control col-sm-8 mr-2 mb-2" style="border-radius: 10px"
                                tabindex="1">
                            <button type="button" class="btn btn-outline-primary" style="border-radius: 10px"><i
                                    class="fa fa-search" aria-hidden="true"></i>
                            </button>
                        </form>
                        <div id="patientfileList" style="max-height: 400px;overflow: auto;">
                        </div>

                    </div>
                </div>
            </div>
            <script>
                cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
                cornerstoneWADOImageLoader.configure({
                    beforeSend: function (xhr) {
                        // Add custom headers here (e.g. auth tokens)
                        //xhr.setRequestHeader('APIKEY', 'my auth token');
                    }
                });
                var loaded = false;
                function loadAndViewImage2(imageId) {
                    var canvas = document.getElementsByTagName('canvas')[1];
                    canvas.width = 300;
                    canvas.height = 300;
                    canvas.style.height = "300px";
                    canvas.style.width = "300px";
                    var element = document.getElementById('canvasgenerator1');
                    try {
                        var start = new Date().getTime();
                        cornerstone.loadAndCacheImage(imageId).then(function (image) {
                            console.log(image);
                            var viewport = cornerstone.getDefaultViewportForImage(element, image);
                            cornerstone.displayImage(element, image, viewport);
                            console.log(element);
                            console.log(viewport);
                            if (loaded === false) {
                                cornerstoneTools.mouseInput.enable(element);
                                cornerstoneTools.mouseWheelInput.enable(element);
                                cornerstoneTools.wwwc.activate(element, 1); // ww/wc is the default tool for left mouse button
                                cornerstoneTools.pan.activate(element, 2); // pan is the default tool for middle mouse button
                                cornerstoneTools.zoom.activate(element, 4); // zoom is the default tool for right mouse button
                                cornerstoneTools.zoomWheel.activate(element); // zoom is the default tool for middle mouse wheel
                                loaded = true;
                            }

                            function getTransferSyntax() {
                                const value = image.data.string('x00020010');
                                return value + ' [' + uids[value] + ']';
                            }

                            function getSopClass() {
                                const value = image.data.string('x00080016');
                                return value + ' [' + uids[value] + ']';
                            }

                            function getPixelRepresentation() {
                                const value = image.data.uint16('x00280103');
                                if (value === undefined) {
                                    return;
                                }
                                return value + (value === 0 ? ' (unsigned)' : ' (signed)');
                            }

                            function getPlanarConfiguration() {
                                const value = image.data.uint16('x00280006');
                                if (value === undefined) {
                                    return;
                                }
                                return value + (value === 0 ? ' (pixel)' : ' (plane)');
                            }
                        }, function (err) {
                            alert(err);
                        });
                    }
                    catch (err) {
                        alert(err);
                    }
                }

                function downloadAndView() {
                    let url = document.getElementById('wadoURL').value;
                    // prefix the url with wadouri: so cornerstone can find the image loader
                    url = "wadouri:" + url;
                    // image enable the dicomImage element and activate a few tools
                    loadAndViewImage2(url);
                }
                function getUrlWithoutFrame() {
                    var url = document.getElementById('wadoURL').value;
                    var frameIndex = url.indexOf('frame=');
                    if (frameIndex !== -1) {
                        url = url.substr(0, frameIndex - 1);
                    }
                    return url;
                }
                var element = document.getElementById('canvasgenerator1');
                cornerstone.enable(element);

            </script>
    </section>
    <!-- Doctor Section -->

    <section id="doctor" style="display: none;">
        <div class="container">
            <div class="row">

                <div class="col-md-8 col-sm-6">
                    <h4 class="mt-3">Preview</h4>
                    <div id='doctorFilePreview' class="jumbotron mt-4 ml-0" style="border-radius: 20px;">
                        <p><img id="output" width="300" /></p>
                        <div id="canvasgenerator2"></div>
                    </div>
                </div>

                <div class="col-md-4 col-sm-6">
                    <div class="jumbotron mt-3" style="border-radius: 50px;">
                        <form class="form-inline" method="POST" onsubmit="return false">
                            <input type="text" class="form-control col-sm-8 mr-2 mb-2" style="border-radius: 10px"
                                tabindex="1">
                            <button type="button" class="btn btn-outline-primary" style="border-radius: 10px"><i
                                    class="fa fa-search" aria-hidden="true"></i>
                            </button>
                        </form>
                        <div style="max-height: 400px;overflow: auto;">

                            <div id="doctorfileList" style="max-height: 400px;overflow: auto;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
            cornerstoneWADOImageLoader.configure({
                beforeSend: function (xhr) {
                    // Add custom headers here (e.g. auth tokens)
                    //xhr.setRequestHeader('APIKEY', 'my auth token');
                }
            });
            var loaded = false;
            function loadAndViewImage3(imageId) {
                var canvas = document.getElementsByTagName('canvas')[2];
                canvas.width = 300;
                canvas.height = 300;
                canvas.style.height = "300px";
                canvas.style.width = "300px";
                var element = document.getElementById('canvasgenerator2');
                try {
                    var start = new Date().getTime();
                    cornerstone.loadAndCacheImage(imageId).then(function (image) {
                        console.log(image);
                        var viewport = cornerstone.getDefaultViewportForImage(element, image);
                        cornerstone.displayImage(element, image, viewport);
                        console.log(element);
                        console.log(viewport);
                        if (loaded === false) {
                            cornerstoneTools.mouseInput.enable(element);
                            cornerstoneTools.mouseWheelInput.enable(element);
                            cornerstoneTools.wwwc.activate(element, 1); // ww/wc is the default tool for left mouse button
                            cornerstoneTools.pan.activate(element, 2); // pan is the default tool for middle mouse button
                            cornerstoneTools.zoom.activate(element, 4); // zoom is the default tool for right mouse button
                            cornerstoneTools.zoomWheel.activate(element); // zoom is the default tool for middle mouse wheel
                            loaded = true;
                        }

                        function getTransferSyntax() {
                            const value = image.data.string('x00020010');
                            return value + ' [' + uids[value] + ']';
                        }

                        function getSopClass() {
                            const value = image.data.string('x00080016');
                            return value + ' [' + uids[value] + ']';
                        }

                        function getPixelRepresentation() {
                            const value = image.data.uint16('x00280103');
                            if (value === undefined) {
                                return;
                            }
                            return value + (value === 0 ? ' (unsigned)' : ' (signed)');
                        }

                        function getPlanarConfiguration() {
                            const value = image.data.uint16('x00280006');
                            if (value === undefined) {
                                return;
                            }
                            return value + (value === 0 ? ' (pixel)' : ' (plane)');
                        }
                    }, function (err) {
                        alert(err);
                    });
                }
                catch (err) {
                    alert(err);
                }
            }

            function downloadAndView() {
                let url = document.getElementById('wadoURL').value;
                // prefix the url with wadouri: so cornerstone can find the image loader
                url = "wadouri:" + url;
                // image enable the dicomImage element and activate a few tools
                loadAndViewImage3(url);
            }
            function getUrlWithoutFrame() {
                var url = document.getElementById('wadoURL').value;
                var frameIndex = url.indexOf('frame=');
                if (frameIndex !== -1) {
                    url = url.substr(0, frameIndex - 1);
                }
                return url;
            }
            var element = document.getElementById('canvasgenerator2');
            cornerstone.enable(element);

        </script>
    </section>

    <!-- General Section -->

    <section id="general" style="display: none;">
        <div class="container">
            <div class="row">

                <!-- <div class="col-md-6 col-sm-6">
                    <h1>General Section</h1>
                </div>-->

                <div class="col-md-12 col-sm-12">
                    <h1>Smart X-Ray Scanner</h1>
                    <h3>Theme by Mehta Group of Hospitals</h3>
                    <div>
                        Traditional X-Ray films are bulky and unportable causing patients to leave behind these films
                        when going for follow-up hospital visits, resulting in poorer diagnosis. Currently, the
                        radiology department or diagnostic labs have to print and review the x-ray film and then
                        physically hand it over to the patient/treating doctor for a diagnosis. Help hospitals and
                        diagnostics by enabling better diagnosis and health outcomes, cost savings, the faster mechanism
                        by building a reliable mobile app or lens/scanner that can capture the x-ray image without any
                        loss in image clarity or image distortion.</div>
                </div>

            </div>
        </div>
    </section>


    <!--<script src="{% static '/user/webindex.js' %}"></script>-->
    <script src="{% static '/user/index.js' %}"></script>
    <script src="{% static '/user/auth.js' %}"></script>
    <script src="{% static '/user/radio.js' %}"></script>
    <script src="{% static '/user/patient.js' %}"></script>
    <script src="{% static '/user/doctor.js' %}"></script>


</body>

</html>